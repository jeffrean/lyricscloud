<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="UTF-8">
		<script type="text/javascript" src="wordcloud2.js"></script>
		<script type="text/javascript" src="wordfreq.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="wordcloud.css">
		<style>
			#content {
				top: 30%;
				width: 50%;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		 <div id="search">
			 <script>
		 	     $(function(){
						$("#search").load("index.html");
					});
					document.getElementById("header").innerHTML = getParameterByName('artists'); 
			 </script>
		</div>
		<button id="addTOCloud-button" onclick="AddTOCloud();">Add to Cloud</button>
		<button id="shareToFacebook-button">Share to Facebook</button>

		<div id="content">
			<canvas id="my_canvas" width="800" height="500" ></canvas>
			<script>
				function AddTOCloud() {
					var artistsList = localStorage.getItem("artistList");
					var artistNew = document.getElementById("project-search").value;
					window.location.href = "wordcloud.html?artists=" + artistsList + ',' + artistNew;
				}
				function readJSON(file) {
					var request = new XMLHttpRequest();
					request.open('GET', file, false);
					request.send(null);
					if (request.status == 200)
						return request.responseText;
				}

				function getParameterByName(name, url) {
					 if (!url) {
						url = window.location.href;
					 }
					 name = name.replace(/[\[\]]/g, "\\$&");
					 var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
						  results = regex.exec(url);
					 if (!results) return null;
					 if (!results[2]) return '';
					 return decodeURIComponent(results[2].replace(/\+/g, " "));
				}
				function searchArtists(artists) {
					localStorage.setItem("artistList", artists);
					var raw_lyrics = "";
					var artists_data = [];
					for(var i = 0; i < artists.length; i++)
					{
						var raw = readJSON('getLyrics.php?artist=' + artists[i]);
						var text = JSON.parse(raw);
						for(var j = 0; j < text.songs.length; j++)
						{
							raw_lyrics += ' ' + text.songs[j].lyrics;
						}
						artists_data.push(raw);
					}
					console.log(artists_data);
					localStorage.setItem("artistData", JSON.stringify(artists_data));
					var wordfreq = WordFreq({
						workerUrl: "wordfreq.worker.js",
						stopWords: true
					});
					wordfreq.process(raw_lyrics, function(list) {
						if(list.length > 250) {
							list = list.splice(0, 250);
						}
						var cloud = WordCloud(document.getElementById('my_canvas'), {
							list: list,
							gridSize: 0,
							weightFactor: 1,
							backgroundColor: "white",
							maxRotation: 0,
							minRotation: 0,
							drawOutOfBound: false,
							click: function(item, dimension, event) {
								localStorage.setItem("wordChosen", item);
								window.location = "SongList.html";
							}
						});
					});
				}
				var artists = getParameterByName('artists');
				if(artists==null)
				{
					artists = localStorage.getItem("artists");
				}
				artists = artists.replace(/ /g, "_").split(',');
				searchArtists(artists);
			</script>
		</div>
	</body>
</html>
